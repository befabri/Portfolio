---
import { Icon } from "astro-icon";
import Link from "@components/ui/link.astro";

interface Frontmatter {
    [x: string]: any;
    order: number;
    name: string;
    description: string;
    image: {
        src: string;
        alt: string;
    };
    stack: {
        frontend?: string[];
        backend?: string[];
        project?: string[];
    };
    links: {
        frontend?: string;
        backend?: string;
        extensionStore?: string;
        project?: string;
        website?: string;
        extension?: string;
    };
    link: string;
    tag: string[];
}

const projects = await Astro.glob<Frontmatter>("../content/project/*.mdx");

const images = await Astro.glob("../assets/project/*").then((files) => {
    return files.map((file) => file.default);
});
const imagesObj = images.reduce((imageCollection, image) => {
    const parts = image.src.split("/");
    const fileNameWithExtension = parts[parts.length - 1];
    const fileNameWithoutExtension = fileNameWithExtension.split(".")[0];

    imageCollection[fileNameWithoutExtension] = {
        ...image,
        id: fileNameWithoutExtension,
    };

    return imageCollection;
}, {});

projects.sort((a, b) => a.frontmatter.order - b.frontmatter.order);
---

<div id="project" class="mt-24 px-5">
    <h2 class="text-3xl text-sky-700 dark:text-sky-500 font-bold mb-2">PROJETS</h2>
    {
        projects.map((item) => (
            <div class="">
                <div class="flex flex-col lg:flex-row m-auto sm:w-auto sm:m-0 lg:my-8 sm:py-2 py-8">
                    <div class="overflow-hidden min-w-0 sm:min-w-[480px] h-[280px] border-2 border-zinc-600 dark:border-zinc-300">
                        <a href={item.frontmatter.link}>
                            <img
                                src={imagesObj[item.frontmatter.image.src].src}
                                alt={item.frontmatter.image.alt}
                                class="block w-full h-full cursor-pointer object-top object-cover transition-all duration-1000 transform hover:scale-110"
                            />
                        </a>
                    </div>
                    <div class="my-4 lg:px-8 flex flex-col">
                        <a href={item.frontmatter.link}>
                            <h3 class="flex items-center text-zinc-800 dark:text-zinc-200 font-semibold text-3xl tracking-tight">
                                {item.frontmatter.name}
                            </h3>
                        </a>
                        <p class="mt-3 text-zinc-800 dark:text-zinc-200 text-justify">{item.frontmatter.description}</p>
                        <div class="flex mt-7 mb-2 lg:mb-5">
                            {item.frontmatter.links.website && (
                                <div class="mr-4">
                                    <a
                                        href={item.frontmatter.links.website}
                                        class="underline dark:hover:text-sky-200"
                                        target="_blank"
                                        rel="noopener noreferrer"
                                        aria-label="Lien vers le site web du projet"
                                        title="Cliquez pour voir le site web "
                                    >
                                        Site web ↗︎
                                    </a>
                                </div>
                            )}
                            {item.frontmatter.links.project && (
                                <div>
                                    <a
                                        href={item.frontmatter.links.project}
                                        class="underline dark:hover:text-sky-200"
                                        target="_blank"
                                        rel="noopener noreferrer"
                                        aria-label="Lien vers le dépôt Git"
                                    >
                                        Git Repos ↗︎
                                    </a>
                                </div>
                            )}
                            {!item.frontmatter.links.project && (
                                <div>
                                    <a
                                        href=`${item.frontmatter.link}#liens`
                                        class="underline dark:hover:text-sky-200"
                                        aria-label="Lien vers la page du projet contenant les liens des différents dépôts Git"
                                    >
                                        Git Repos ↗︎
                                    </a>
                                </div>
                            )}
                        </div>
                        <div class="flex lg:mt-9 justify-center lg:justify-end">
                            <a
                                href={item.frontmatter.link}
                                aria-label="Lien vers la page du projet"
                                title="Cliquez pour voir le projet"
                                class="hidden lg:block "
                            >
                                <Icon class="h-10 w-10 text-zinc-800 dark:text-zinc-400 dark:hover:text-sky-200" name="mdi:arrow-right" />
                            </a>
                            <div class="lg:hidden text-center">
                                <Link
                                    style="muted"
                                    href={item.frontmatter.link}
                                    class="inline-block mt-4 py-2 px-4 rounded"
                                >
                                    En savoir plus
                                </Link>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        ))
    }
</div>
